<!DOCTYPE html>
<html lang="zh-TW" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>è§’è‰²è³‡æ–™æª¢è¦–å·¥å…·</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-body">

<nav class="navbar navbar-expand-lg bg-primary navbar-dark">
    <div class="container-fluid">
        <span class="navbar-brand">è§’è‰²è³‡æ–™å·¥å…·</span>

        <div class="ms-auto">
            <button id="toggleTheme" class="btn btn-outline-light btn-sm">
                ğŸŒ™ å¤œé–“æ¨¡å¼
            </button>
        </div>
    </div>
</nav>

<div class="container py-4">

    <div class="card shadow-sm mb-4">
        <div class="card-body">

            <h5 class="card-title mb-3">Google Sheet é€£çµ</h5>

            <div class="input-group">
                <input id="sheetUrl"
                       class="form-control"
                       placeholder="è²¼ä¸Š Google Sheet åˆ†äº«é€£çµï¼ˆéœ€å…¬é–‹ï¼‰">
                <button id="loadBtn" class="btn btn-primary">
                    è®€å–
                </button>
            </div>

            <div id="msg" class="text-danger mt-2"></div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">è§’è‰²æ¸…å–®</h5>

            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-secondary">
                        <tr>
                            <th>è§’è‰²åç¨±</th>
                            <th>è§’è‰²ä»£ç¢¼</th>
                            <th>è§’è‰²è·æ¥­</th>
                            <th>è§’è‰²ç­‰ç´š</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                å°šæœªè®€å–è³‡æ–™
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</div>

<script>
/* =========================
   å¤œé–“æ¨¡å¼åˆ‡æ›
========================= */
$('#toggleTheme').on('click', function () {
    const html = document.documentElement;
    const isDark = html.getAttribute('data-bs-theme') === 'dark';

    html.setAttribute('data-bs-theme', isDark ? 'light' : 'dark');
    $(this).text(isDark ? 'ğŸŒ™ å¤œé–“æ¨¡å¼' : 'â˜€ï¸ æ—¥é–“æ¨¡å¼');
});

/* =========================
   è®€å– Google Sheet
========================= */
$('#loadBtn').on('click', function () {
    $('#msg').text('');
    $('#tableBody').html(`
        <tr>
            <td colspan="4" class="text-center text-muted">è®€å–ä¸­...</td>
        </tr>
    `);

    const url = $('#sheetUrl').val().trim();
    if (!url) {
        $('#msg').text('è«‹è²¼ä¸Š Google Sheet é€£çµ');
        return;
    }

    const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
    if (!match) {
        $('#msg').text('ç„¡æ³•è§£æ Sheet ID');
        return;
    }

    const sheetId = match[1];
    const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;

    Papa.parse(csvUrl, {
        download: true,
        skipEmptyLines: true,
        complete: function (result) {
            if (!result.data || result.data.length < 2) {
                $('#msg').text('æ²’æœ‰è³‡æ–™å¯é¡¯ç¤º');
                return;
            }

            const rows = result.data.slice(1);

            const data = rows.map(r => ({
                name:  r[1], // B
                code:  r[2], // C
                job:   r[3], // D
                level: r[4]  // E
            })).filter(r => r.name);

            renderTable(data);
        },
        error: function () {
            $('#msg').text('è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª Sheet ç‚ºå…¬é–‹ä¸”ä½¿ç”¨ http é–‹å•Ÿ');
        }
    });
});

/* =========================
   Render Table
========================= */
function renderTable(data) {
    if (!data.length) {
        $('#tableBody').html(`
            <tr>
                <td colspan="4" class="text-center text-muted">
                    æ²’æœ‰ç¬¦åˆçš„è³‡æ–™
                </td>
            </tr>
        `);
        return;
    }

    let html = '';
    data.forEach(r => {
        html += `
            <tr>
                <td>${r.name}</td>
                <td>${r.code}</td>
                <td>${r.job}</td>
                <td>${r.level}</td>
            </tr>
        `;
    });

    $('#tableBody').html(html);
}

<!-- å³ä¸Šè§’ã€çµ„éšŠã€‘æŒ‰éˆ• -->
<div class="top-right">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#partyModal">
        ğŸ‘¥ çµ„éšŠ
    </button>
</div>

<!-- çµ„éšŠ Modal -->
<div class="modal fade" id="partyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title">çµ„éšŠè§’è‰²æ¸…å–®</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul id="partyList" class="list-group list-group-flush"></ul>
            </div>
        </div>
    </div>
</div>
</script>

</body>
</html>
